<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="CacheGitHubCI.Task">
<Description>
Simple update task. Use CacheGitHubCI.Hook if you need more functionality.</Description>
<Super>%SYS.Task.Definition</Super>
<TimeCreated>63600,45875.997358</TimeCreated>

<Parameter name="TaskName">
<Default>GitHubUpdateTask</Default>
</Parameter>

<Property name="GitHubURL">
<Description>
Repository URL, like https://github.com/intersystems-ru/Cache-MDX2JSON</Description>
<Type>%String</Type>
</Property>

<Property name="Namespace">
<Description>
Namespace, where to download and compile repository</Description>
<Type>%String</Type>
<InitialExpression>$Namespace</InitialExpression>
</Property>

<Method name="OnTask">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set Owner = $p(..GitHubURL,"/",4)
	Set Repository = $p(..GitHubURL,"/",5)
	Set TaskId = Owner _ "||" _ Repository _ "||" _ ..Namespace
	
	If '##class(CacheGitHubCI.Hook).%ExistsId(TaskId) {
		Set hook=##class(CacheGitHubCI.Hook).%New()     
		Set hook.Namespace = ..Namespace                       
		Set hook.Owner = Owner            
		Set hook.Repository = Repository      
		Set hook.Branch = "master"                    
		Set st = hook.%Save()
		Quit:$$$ERROR(st) st
		kill (TaskId)		
	}
	
	Quit ##class(CacheGitHubCI.Hook).Update(TaskId)
]]></Implementation>
</Method>
</Class>
</Export>
